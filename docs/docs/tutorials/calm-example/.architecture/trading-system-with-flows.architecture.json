{
    "$schema": "https://calm.finos.org/release/1.1/meta/calm.json",
    "unique-id": "trading-system",
    "name": "Trading System",
    "description": "A sample trading application demonstrating typical trading workflows and business processes for financial services operations in an event-driven architecture",
    "metadata": [
        {
            "version": "1.0.0",
            "created-by": "Architecture Team",
            "purpose": "Educational reference implementation",
            "architecture-style": "Event-Driven Microservices"
        }
    ],
    "nodes": [
        {
            "unique-id": "trader",
            "node-type": "actor",
            "name": "Trader",
            "description": "End users who submit trades and monitor positions"
        },
        {
            "unique-id": "administrator",
            "node-type": "actor",
            "name": "Administrator",
            "description": "Users who manage accounts and user associations"
        },
        {
            "unique-id": "trading-ui",
            "node-type": "webclient",
            "name": "Trading UI",
            "description": "Web-based trading interface for users to submit orders, view positions, and monitor trade history"
        },
        {
            "unique-id": "order-submission-service",
            "node-type": "service",
            "name": "Order Submission Service",
            "description": "API service that receives and validates trade orders from the UI before publishing to event stream"
        },
        {
            "unique-id": "trade-execution-service",
            "node-type": "service",
            "name": "Trade Execution Service",
            "description": "Service that consumes order events, executes trades, and publishes trade execution events"
        },
        {
            "unique-id": "position-service",
            "node-type": "service",
            "name": "Position Service",
            "description": "Service that maintains current positions by consuming trade execution events and calculating aggregated holdings"
        },
        {
            "unique-id": "account-service",
            "node-type": "service",
            "name": "Account Service",
            "description": "Service managing trading account CRUD operations and user-account associations"
        },
        {
            "unique-id": "trade-event-notification",
            "node-type": "service",
            "name": "Trade Event Notification",
            "description": "Event infrastructure service handling order submissions, trade executions, position updates, and user notifications through event streams and topics"
        },
        {
            "unique-id": "trade-database",
            "node-type": "database",
            "name": "Trade Database",
            "description": "Consolidated database storing trade history, execution records, current account positions, trading accounts, and user-account associations"
        },
        {
            "unique-id": "security-reference-database",
            "node-type": "database",
            "name": "Security Reference Database",
            "description": "Master database of tradeable securities with company information"
        },
        {
            "unique-id": "user-directory",
            "node-type": "ldap",
            "name": "User Directory",
            "description": "Directory service storing user profiles and contact information"
        }
    ],
    "relationships": [
        {
            "unique-id": "trader-trading-ui",
            "description": "Submits orders and monitors trades using",
            "relationship-type": {
                "interacts": {
                    "actor": "trader",
                    "nodes": [
                        "trading-ui"
                    ]
                }
            }
        },
        {
            "unique-id": "administrator-trading-ui",
            "description": "Manages accounts and user associations using",
            "relationship-type": {
                "interacts": {
                    "actor": "administrator",
                    "nodes": [
                        "trading-ui"
                    ]
                }
            }
        },
        {
            "unique-id": "trading-ui-order-submission-service",
            "description": "Sends trade orders to",
            "relationship-type": {
                "connects": {
                    "source": {
                        "node": "trading-ui"
                    },
                    "destination": {
                        "node": "order-submission-service"
                    }
                }
            },
            "protocol": "HTTPS"
        },
        {
            "unique-id": "trading-ui-account-service",
            "description": "Retrieves account information and manages associations via",
            "relationship-type": {
                "connects": {
                    "source": {
                        "node": "trading-ui"
                    },
                    "destination": {
                        "node": "account-service"
                    }
                }
            },
            "protocol": "HTTPS"
        },
        {
            "unique-id": "order-submission-service-trade-event-notification",
            "description": "Publishes validated order events to",
            "relationship-type": {
                "connects": {
                    "source": {
                        "node": "order-submission-service"
                    },
                    "destination": {
                        "node": "trade-event-notification"
                    }
                }
            },
            "protocol": "AMQP"
        },
        {
            "unique-id": "order-submission-service-security-reference-database",
            "description": "Validates securities against",
            "relationship-type": {
                "connects": {
                    "source": {
                        "node": "order-submission-service"
                    },
                    "destination": {
                        "node": "security-reference-database"
                    }
                }
            },
            "protocol": "JDBC"
        },
        {
            "unique-id": "trade-event-notification-trade-execution-service",
            "description": "Delivers order events to",
            "relationship-type": {
                "connects": {
                    "source": {
                        "node": "trade-event-notification"
                    },
                    "destination": {
                        "node": "trade-execution-service"
                    }
                }
            },
            "protocol": "AMQP"
        },
        {
            "unique-id": "trade-execution-service-trade-database",
            "description": "Persists executed trades to",
            "relationship-type": {
                "connects": {
                    "source": {
                        "node": "trade-execution-service"
                    },
                    "destination": {
                        "node": "trade-database"
                    }
                }
            },
            "protocol": "JDBC"
        },
        {
            "unique-id": "trade-execution-service-trade-event-notification",
            "description": "Publishes trade execution events to",
            "relationship-type": {
                "connects": {
                    "source": {
                        "node": "trade-execution-service"
                    },
                    "destination": {
                        "node": "trade-event-notification"
                    }
                }
            },
            "protocol": "AMQP"
        },
        {
            "unique-id": "trade-event-notification-position-service",
            "description": "Delivers trade execution events to",
            "relationship-type": {
                "connects": {
                    "source": {
                        "node": "trade-event-notification"
                    },
                    "destination": {
                        "node": "position-service"
                    }
                }
            },
            "protocol": "AMQP"
        },
        {
            "unique-id": "position-service-trade-database",
            "description": "Updates positions and reads trade history from",
            "relationship-type": {
                "connects": {
                    "source": {
                        "node": "position-service"
                    },
                    "destination": {
                        "node": "trade-database"
                    }
                }
            },
            "protocol": "JDBC"
        },
        {
            "unique-id": "position-service-trade-event-notification",
            "description": "Publishes position update events to",
            "relationship-type": {
                "connects": {
                    "source": {
                        "node": "position-service"
                    },
                    "destination": {
                        "node": "trade-event-notification"
                    }
                }
            },
            "protocol": "AMQP"
        },
        {
            "unique-id": "account-service-trade-database",
            "description": "Manages account data and user associations in",
            "relationship-type": {
                "connects": {
                    "source": {
                        "node": "account-service"
                    },
                    "destination": {
                        "node": "trade-database"
                    }
                }
            },
            "protocol": "JDBC"
        },
        {
            "unique-id": "account-service-user-directory",
            "description": "Retrieves user information from",
            "relationship-type": {
                "connects": {
                    "source": {
                        "node": "account-service"
                    },
                    "destination": {
                        "node": "user-directory"
                    }
                }
            },
            "protocol": "LDAP"
        },
        {
            "unique-id": "trade-event-notification-trading-ui",
            "description": "Pushes real-time updates to",
            "relationship-type": {
                "connects": {
                    "source": {
                        "node": "trade-event-notification"
                    },
                    "destination": {
                        "node": "trading-ui"
                    }
                }
            },
            "protocol": "WebSocket"
        }
    ],
    "flows": [
        {
            "unique-id": "trade-order-submission-flow",
            "name": "Trade Order Submission Flow",
            "description": "End-to-end process for submitting and validating trade orders from trader to event notification system",
            "transitions": [
                {
                    "relationship-unique-id": "trader-trading-ui",
                    "sequence-number": 1,
                    "description": "Trader submits trade order through UI",
                    "direction": "source-to-destination"
                },
                {
                    "relationship-unique-id": "trading-ui-order-submission-service",
                    "sequence-number": 2,
                    "description": "UI sends order to submission service for validation",
                    "direction": "source-to-destination"
                },
                {
                    "relationship-unique-id": "order-submission-service-security-reference-database",
                    "sequence-number": 3,
                    "description": "Service validates security symbol against reference data",
                    "direction": "source-to-destination"
                },
                {
                    "relationship-unique-id": "order-submission-service-trade-event-notification",
                    "sequence-number": 4,
                    "description": "Validated order published to event notification system",
                    "direction": "source-to-destination"
                }
            ],
            "metadata": [
                {
                    "business-criticality": "high",
                    "sla": "< 200ms",
                    "peak-throughput": "1000 orders/second"
                }
            ]
        },
        {
            "unique-id": "trade-execution-flow",
            "name": "Trade Execution Flow",
            "description": "Process of executing validated trade orders and updating positions",
            "transitions": [
                {
                    "relationship-unique-id": "trade-event-notification-trade-execution-service",
                    "sequence-number": 1,
                    "description": "Execution service consumes validated order from event stream",
                    "direction": "source-to-destination"
                },
                {
                    "relationship-unique-id": "trade-execution-service-trade-database",
                    "sequence-number": 2,
                    "description": "Executed trade persisted to database",
                    "direction": "source-to-destination"
                },
                {
                    "relationship-unique-id": "trade-execution-service-trade-event-notification",
                    "sequence-number": 3,
                    "description": "Trade execution event published to notification system",
                    "direction": "source-to-destination"
                },
                {
                    "relationship-unique-id": "trade-event-notification-position-service",
                    "sequence-number": 4,
                    "description": "Position service receives trade execution event",
                    "direction": "source-to-destination"
                },
                {
                    "relationship-unique-id": "position-service-trade-database",
                    "sequence-number": 5,
                    "description": "Position service updates account positions based on trade",
                    "direction": "source-to-destination"
                }
            ],
            "metadata": [
                {
                    "business-criticality": "critical",
                    "sla": "< 500ms",
                    "compliance": [
                        "MiFID II",
                        "Reg NMS"
                    ]
                }
            ]
        },
        {
            "unique-id": "position-update-notification-flow",
            "name": "Position Update Notification Flow",
            "description": "Real-time notification of position changes to traders",
            "transitions": [
                {
                    "relationship-unique-id": "position-service-trade-event-notification",
                    "sequence-number": 1,
                    "description": "Position update event published to notification system",
                    "direction": "source-to-destination"
                },
                {
                    "relationship-unique-id": "trade-event-notification-trading-ui",
                    "sequence-number": 2,
                    "description": "Real-time position update pushed to trading UI",
                    "direction": "source-to-destination"
                }
            ],
            "metadata": [
                {
                    "business-criticality": "high",
                    "sla": "< 100ms",
                    "protocol": "WebSocket push notification"
                }
            ]
        },
        {
            "unique-id": "account-management-flow",
            "name": "Account Management Flow",
            "description": "Administrator workflow for creating accounts and associating users",
            "transitions": [
                {
                    "relationship-unique-id": "administrator-trading-ui",
                    "sequence-number": 1,
                    "description": "Administrator accesses account management interface",
                    "direction": "source-to-destination"
                },
                {
                    "relationship-unique-id": "trading-ui-account-service",
                    "sequence-number": 2,
                    "description": "UI submits account creation or update request",
                    "direction": "source-to-destination"
                },
                {
                    "relationship-unique-id": "account-service-user-directory",
                    "sequence-number": 3,
                    "description": "Service retrieves user information from directory",
                    "direction": "source-to-destination"
                },
                {
                    "relationship-unique-id": "account-service-trade-database",
                    "sequence-number": 4,
                    "description": "Account and user associations persisted to database",
                    "direction": "source-to-destination"
                }
            ],
            "metadata": [
                {
                    "business-criticality": "medium",
                    "sla": "< 2 seconds",
                    "compliance": [
                        "SOX",
                        "Access Control"
                    ]
                }
            ]
        }
    ]
}