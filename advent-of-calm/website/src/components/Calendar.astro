---
import { getAllDays } from '../utils/calendar';

const days = getAllDays();
---

<div class="calendar-grid" id="calendar-grid">
  {days.map(({ day, unlocked, title }) => (
    <a 
      href={unlocked ? `./day/${day}` : '#'}
      class:list={['calendar-day', { locked: !unlocked, unlocked }]}
      title={unlocked ? title : `Unlocks December ${day}`}
      aria-disabled={!unlocked}
    >
      <div class="day-number">{day}</div>
      <div class="day-icon">
        {unlocked ? (
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M5 13l4 4L19 7" />
          </svg>
        ) : (
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
            <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
          </svg>
        )}
      </div>
    </a>
  ))}
</div>

<style>
  .calendar-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
    gap: var(--spacing-md);
    margin: var(--spacing-xl) 0;
  }
  
  .calendar-day {
    aspect-ratio: 1;
    border: 2px solid var(--color-border);
    border-radius: var(--border-radius);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: var(--spacing-xs);
    transition: all 0.3s ease;
    cursor: pointer;
    text-decoration: none;
    position: relative;
    overflow: hidden;
  }
  
  .calendar-day.unlocked {
    background: linear-gradient(135deg, var(--color-accent-light) 0%, white 100%);
    border-color: var(--color-accent);
    color: var(--color-primary);
  }
  
  .calendar-day.unlocked:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-lg);
    border-color: var(--color-primary);
  }
  
  .calendar-day.locked {
    background: #f9fafb;
    border-color: var(--color-border);
    color: var(--color-locked);
    cursor: not-allowed;
    pointer-events: none;
  }
  
  .day-number {
    font-size: 2rem;
    font-weight: 700;
  }
  
  .day-icon {
    width: 24px;
    height: 24px;
  }
  
  .day-icon svg {
    width: 100%;
    height: 100%;
  }
  
  @media (max-width: 768px) {
    .calendar-grid {
      grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      gap: var(--spacing-sm);
    }
    
    .day-number {
      font-size: 1.5rem;
    }
    
    .day-icon {
      width: 20px;
      height: 20px;
    }
  }
</style>

<script>
  // Client-side debug mode
  const params = new URLSearchParams(window.location.search);
  if (params.has('debug')) {
    const calendar = document.getElementById('calendar-grid');
    if (calendar) {
      const days = calendar.querySelectorAll('.calendar-day');
      days.forEach((day, index) => {
        const dayNumber = index + 1;
        const dayElement = day as HTMLElement;
        dayElement.classList.remove('locked');
        dayElement.classList.add('unlocked');
        dayElement.setAttribute('href', `./day/${dayNumber}`);
        dayElement.removeAttribute('aria-disabled');
        dayElement.style.pointerEvents = 'auto';
        dayElement.style.cursor = 'pointer';
      });
    }
  }
</script>
