name: Validation of CALM Samples

permissions:
    contents: read

on:
    pull_request:
        branches:
            - 'main'
        paths:
            - 'calm/draft/**'
            - 'calm/pattern/**'
            - 'calm/samples/**'
            - 'shared/src/spectral/**'
    push:
        branches:
            - 'main'
        paths:
            - 'calm/draft/**'
            - 'calm/pattern/**'
            - 'calm/samples/**'
            - 'shared/src/spectral/**'

jobs:
    spectrals:
        name: Run Spectral
        runs-on: ubuntu-latest
        steps:
            # Check out the repository
            - uses: actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8 # v5

            # Run Spectral
            - uses: actions/setup-node@49933ea5288caeca8642d1e84afbd3f7d6820020 # v4
              with:
                  node-version: v22

            - name: Install workspace
              run: npm ci

            - name: Build workspace
              run: npm run build

            - name: Install dependencies for Spectral
              run: npm install @stoplight/spectral-cli rollup

            - name: Run Example Spectral Linting
              run: npx spectral lint --ruleset ./shared/dist/spectral/rules-architecture.js 'calm/samples/api-gateway-architecture(*.json|*.yaml)'
